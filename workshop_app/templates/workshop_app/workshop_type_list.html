{% extends 'workshop_app/base.html' %}
{% load custom_filters %}
{% block title %}
	View List of available Workshops
{% endblock %}

{% block content %}
	<div class="container py-3">
	<div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
		<h2 class="h4 m-0">Workshop Types</h2>
		{% if request.user|has_group:"instructor" %}
		<a href="{% url 'workshop_app:add_workshop_type' %}" class="btn btn-primary">
			Add Workshop Type
		</a>
		{% endif %}
	</div>
	<hr class="my-3"/>
	<div class="mt-3">
		<table class="table table-hover align-middle">
		  <thead>
		    <tr>
		      <th>Sr No</th>
		      <th>Workshop Name</th>
		      <th>Workshop Duration (Days)</th>
		      <th>Action</th>
		    </tr>
		  </thead>

		{% for w in workshop_type %}
					<tbody>
						<tr>
							<td scope="row" id="{{ forloop.counter }}">{{ forloop.counter }}</td>
							<td class="fw-medium">{{ w.name }}</td>
							<td><span class="badge bg-secondary-subtle text-secondary">{{ w.duration }}</span></td>
											<td>
												<a href="{% url 'workshop_app:workshop_type_details' w.id %}" class="btn btn-outline-primary btn-sm view-details" data-id="{{ w.id }}">View Details</a>
											</td>
						</tr>
					</tbody>
		 {% endfor %}
		</table>
	</div>

	    <!-- The Modal -->
	    <div id="mailModal" class="modal">

	    <!-- Modal content -->
	    <div class="modal-content">
		<span class="close">&times;</span>
		<p>Separate Multiple Email Id's using <strong> comma (,)</strong></p>
		<form action="{{URL_ROOT}}/share_details/" method="POST">
		  {% csrf_token %}
		    <label > Email: </label>
		    <input name="email" type='email' multiple>
		    <input type='submit'>
		</form>
	    </div>
	    </div>

<!-- Page Navigation -->
		<div class="d-flex justify-content-center my-3">
		<nav aria-label="Page navigation">
			<ul class="pagination pagination-sm mb-0">
				<li class="page-item {% if not workshop_type.has_previous %}disabled{% endif %}">
					<a class="page-link" href="{% if workshop_type.has_previous %}?page={{ workshop_type.previous_page_number }}{% else %}#{% endif %}" tabindex="-1">Previous</a>
				</li>
				<li class="page-item disabled"><span class="page-link">Page {{ workshop_type.number }} of {{ workshop_type.paginator.num_pages }}</span></li>
				<li class="page-item {% if not workshop_type.has_next %}disabled{% endif %}">
					<a class="page-link" href="{% if workshop_type.has_next %}?page={{ workshop_type.next_page_number }}{% else %}#{% endif %}">Next</a>
				</li>
			</ul>
		</nav>
	</div>

		<!-- Details Modal -->
		<div class="modal fade" id="typeDetailsModal" tabindex="-1" aria-labelledby="typeDetailsLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="typeDetailsLabel">Workshop Details</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body p-0" style="height:70vh;">
						<iframe id="typeDetailsFrame" src="about:blank" style="border:0; width:100%; height:100%;"></iframe>
					</div>
				</div>
			</div>
		</div>

		<script>
			(function(){
				const modalEl = document.getElementById('typeDetailsModal');
				const frame = document.getElementById('typeDetailsFrame');
				let modal;
				if(modalEl){ modal = new bootstrap.Modal(modalEl); }
				document.querySelectorAll('.view-details').forEach(function(btn){
					btn.addEventListener('click', function(e){
						e.preventDefault();
						if(frame){ frame.src = this.getAttribute('href'); }
						if(modal){ modal.show(); }
					});
				});
				if(modalEl){
					modalEl.addEventListener('hidden.bs.modal', function(){ if(frame){ frame.src='about:blank'; } });
				}
			})();
		</script>
</div>
{% endblock %}
